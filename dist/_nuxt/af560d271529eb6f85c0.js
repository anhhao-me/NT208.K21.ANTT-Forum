(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{389:function(t,e,n){var content=n(527);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(89).default)("5c056b0e",content,!0,{sourceMap:!1})},525:function(t,e,n){var map={"./af":392,"./af.js":392,"./ar":393,"./ar-dz":394,"./ar-dz.js":394,"./ar-kw":395,"./ar-kw.js":395,"./ar-ly":396,"./ar-ly.js":396,"./ar-ma":397,"./ar-ma.js":397,"./ar-sa":398,"./ar-sa.js":398,"./ar-tn":399,"./ar-tn.js":399,"./ar.js":393,"./az":400,"./az.js":400,"./be":401,"./be.js":401,"./bg":402,"./bg.js":402,"./bm":403,"./bm.js":403,"./bn":404,"./bn.js":404,"./bo":405,"./bo.js":405,"./br":406,"./br.js":406,"./bs":407,"./bs.js":407,"./ca":408,"./ca.js":408,"./cs":409,"./cs.js":409,"./cv":410,"./cv.js":410,"./cy":411,"./cy.js":411,"./da":412,"./da.js":412,"./de":413,"./de-at":414,"./de-at.js":414,"./de-ch":415,"./de-ch.js":415,"./de.js":413,"./dv":416,"./dv.js":416,"./el":417,"./el.js":417,"./en-au":418,"./en-au.js":418,"./en-ca":419,"./en-ca.js":419,"./en-gb":420,"./en-gb.js":420,"./en-ie":421,"./en-ie.js":421,"./en-il":422,"./en-il.js":422,"./en-in":423,"./en-in.js":423,"./en-nz":424,"./en-nz.js":424,"./en-sg":425,"./en-sg.js":425,"./eo":426,"./eo.js":426,"./es":427,"./es-do":428,"./es-do.js":428,"./es-us":429,"./es-us.js":429,"./es.js":427,"./et":430,"./et.js":430,"./eu":431,"./eu.js":431,"./fa":432,"./fa.js":432,"./fi":433,"./fi.js":433,"./fil":434,"./fil.js":434,"./fo":435,"./fo.js":435,"./fr":436,"./fr-ca":437,"./fr-ca.js":437,"./fr-ch":438,"./fr-ch.js":438,"./fr.js":436,"./fy":439,"./fy.js":439,"./ga":440,"./ga.js":440,"./gd":441,"./gd.js":441,"./gl":442,"./gl.js":442,"./gom-deva":443,"./gom-deva.js":443,"./gom-latn":444,"./gom-latn.js":444,"./gu":445,"./gu.js":445,"./he":446,"./he.js":446,"./hi":447,"./hi.js":447,"./hr":448,"./hr.js":448,"./hu":449,"./hu.js":449,"./hy-am":450,"./hy-am.js":450,"./id":451,"./id.js":451,"./is":452,"./is.js":452,"./it":453,"./it-ch":454,"./it-ch.js":454,"./it.js":453,"./ja":455,"./ja.js":455,"./jv":456,"./jv.js":456,"./ka":457,"./ka.js":457,"./kk":458,"./kk.js":458,"./km":459,"./km.js":459,"./kn":460,"./kn.js":460,"./ko":461,"./ko.js":461,"./ku":462,"./ku.js":462,"./ky":463,"./ky.js":463,"./lb":464,"./lb.js":464,"./lo":465,"./lo.js":465,"./lt":466,"./lt.js":466,"./lv":467,"./lv.js":467,"./me":468,"./me.js":468,"./mi":469,"./mi.js":469,"./mk":470,"./mk.js":470,"./ml":471,"./ml.js":471,"./mn":472,"./mn.js":472,"./mr":473,"./mr.js":473,"./ms":474,"./ms-my":475,"./ms-my.js":475,"./ms.js":474,"./mt":476,"./mt.js":476,"./my":477,"./my.js":477,"./nb":478,"./nb.js":478,"./ne":479,"./ne.js":479,"./nl":480,"./nl-be":481,"./nl-be.js":481,"./nl.js":480,"./nn":482,"./nn.js":482,"./oc-lnc":483,"./oc-lnc.js":483,"./pa-in":484,"./pa-in.js":484,"./pl":485,"./pl.js":485,"./pt":486,"./pt-br":487,"./pt-br.js":487,"./pt.js":486,"./ro":488,"./ro.js":488,"./ru":489,"./ru.js":489,"./sd":490,"./sd.js":490,"./se":491,"./se.js":491,"./si":492,"./si.js":492,"./sk":493,"./sk.js":493,"./sl":494,"./sl.js":494,"./sq":495,"./sq.js":495,"./sr":496,"./sr-cyrl":497,"./sr-cyrl.js":497,"./sr.js":496,"./ss":498,"./ss.js":498,"./sv":499,"./sv.js":499,"./sw":500,"./sw.js":500,"./ta":501,"./ta.js":501,"./te":502,"./te.js":502,"./tet":503,"./tet.js":503,"./tg":504,"./tg.js":504,"./th":505,"./th.js":505,"./tk":506,"./tk.js":506,"./tl-ph":507,"./tl-ph.js":507,"./tlh":508,"./tlh.js":508,"./tr":509,"./tr.js":509,"./tzl":510,"./tzl.js":510,"./tzm":511,"./tzm-latn":512,"./tzm-latn.js":512,"./tzm.js":511,"./ug-cn":513,"./ug-cn.js":513,"./uk":514,"./uk.js":514,"./ur":515,"./ur.js":515,"./uz":516,"./uz-latn":517,"./uz-latn.js":517,"./uz.js":516,"./vi":518,"./vi.js":518,"./x-pseudo":519,"./x-pseudo.js":519,"./yo":520,"./yo.js":520,"./zh-cn":521,"./zh-cn.js":521,"./zh-hk":522,"./zh-hk.js":522,"./zh-mo":523,"./zh-mo.js":523,"./zh-tw":524,"./zh-tw.js":524};function r(t){var e=o(t);return n(e)}function o(t){if(!n.o(map,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return map[t]}r.keys=function(){return Object.keys(map)},r.resolve=o,t.exports=r,r.id=525},526:function(t,e,n){"use strict";var r=n(389);n.n(r).a},527:function(t,e,n){(e=n(88)(!1)).push([t.i,".content img{max-width:100%}",""]),t.exports=e},530:function(t,e,n){"use strict";n.r(e);n(14),n(11),n(12),n(10),n(13),n(51);var r=n(22),o=(n(26),n(1)),c=n(153),m=n(45),l=n(388),d=n.n(l),j=n(391),f=n.n(j);function v(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function h(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var k={components:{CommentBox:y},data:function(){return{commentLiked:!1,likeCount:0}},name:"comment-box",props:["comment","topic"],computed:h({},Object(m.c)(["user"])),methods:h(h({},Object(m.b)(["onload","outload","notify"])),{},{makeReply:function(t){this.$emit("reply",t)},editComment:function(t){this.$emit("edit",t)},formatDate:function(t){return d()(t).format("YYYY/MM/DD HH:mm:ss")},randomAvatar:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(c.a)();return"https://icotar.com/avatar/".concat(t)},toggleLikeComment:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user){e.next=2;break}return e.abrupt("return");case 2:if(t.comment){e.next=4;break}return e.abrupt("return");case 4:return t.onload(),e.prev=5,e.next=8,t.$axios.$post("/comment/liked/",{user_id:t.user.id,topic_id:t.topic.id,comment_id:t.comment.id});case 8:e.sent?(t.commentLiked=!0,t.likeCount++):(t.commentLiked=!1,t.likeCount--),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),t.notify({msg:"Đã xảy ra lỗi - ".concat(e.t0.message),variant:"danger"});case 15:t.outload();case 16:case"end":return e.stop()}}),e,null,[[5,12]])})))()}}),mounted:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.onload(),e.next=3,t.toggleLikeComment();case 3:return e.next=5,t.toggleLikeComment();case 5:return e.next=7,t.$axios.$get("/comment/".concat(t.comment.id,"/likes/"));case 7:if(e.t0=e.sent.number_of_likes,e.t0){e.next=10;break}e.t0=0;case 10:t.likeCount=e.t0,t.outload();case 12:case"end":return e.stop()}}),e)})))()}},_=n(43),y=Object(_.a)(k,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-media",{attrs:{"vertical-align":"top"},scopedSlots:t._u([{key:"aside",fn:function(){return[n("b-img",{attrs:{src:t.randomAvatar(t.comment.user_username),width:"64",alt:"placeholder",rounded:"circle"}})]},proxy:!0}])},[t._v(" "),n("p",{staticClass:"mb-2 d-flex justify-content-between"},[n("b",[t._v(t._s(t.comment.user_username))]),t._v(" "),n("i",{staticClass:"text-secondary"},[n("small",[n("b",[t._v(t._s(t.formatDate(t.comment.created_at)))])])])]),t._v(" "),n("div",{staticClass:"content",domProps:{innerHTML:t._s(t.comment.content)}}),t._v(" "),n("div",{staticClass:"text-right"},[n("div",{staticClass:"badge text-danger"},[t._v(t._s(t.likeCount)+" lượt thích")]),t._v(" "),n("b-button",{attrs:{variant:t.commentLiked?"outline-danger":"danger",size:"sm"},on:{click:t.toggleLikeComment}},[t._v(t._s(t.commentLiked?"Đã thích":"Thích"))]),t._v(" "),t.user&&t.comment.user_id===t.user.id?n("b-button",{attrs:{variant:"outline-secondary",size:"sm"},on:{click:function(e){return t.editComment(t.comment)}}},[t._v("Chỉnh sửa")]):t._e(),t._v(" "),n("b-button",{attrs:{variant:"outline-primary",size:"sm",href:"#comment-box"},on:{click:function(e){return t.makeReply(t.comment)}}},[t._v("Trả lời")])],1),t._v(" "),t.comment.children?n("div",{staticClass:"mt-3"},t._l(t.comment.children,(function(e){return n("comment-box",{key:"comment-"+e.id,attrs:{comment:e,topic:t.topic},on:{reply:t.makeReply,edit:t.editComment}})})),1):t._e()])}),[],!1,null,null,null).exports;function x(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function C(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?x(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):x(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var w={components:{CommentBox:y},data:function(){for(var t=parseInt(this.$route.params.id),e=[],i=0;i<5;i++)e.push(i);return{list:e,id:isNaN(t)?null:t,topic:null,topics:[],categories:[],author:null,topicLiked:!1,likeCount:0,viewCount:0,commentContent:"",comments:[],editCommentForm:{content:"",id:"",target:null},commentToolbar:[["bold","italic","underline"],["link","image"]],commentReply:null}},computed:C(C({},Object(m.c)(["user"])),{},{breadcrumbCategory:function(){if(!this.topic)return[];var t=[{text:this.topic.title,href:"/topic/".concat(this.topic.id)}];if(!this.topic.category)return t;for(var e=this.topic.category;e;){var n=this.categories.filter((function(t){return t.id===e}))[0];e=null,n&&(t.unshift({text:n.name,href:"/category/".concat(n.id)}),e=n.parent)}return t}}),methods:C(C({},Object(m.b)(["onload","outload","notify"])),{},{randomAvatar:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(c.a)();return"https://icotar.com/avatar/".concat(t)},truncateText:function(text,t){return text.length>t-3?text.substr(0,t-3)+"...":text},formatDate:function(t){return d()(t).format("YYYY/MM/DD HH:mm:ss")},render:function(content){return f()(content)},toggleLikeTopic:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user){e.next=2;break}return e.abrupt("return");case 2:if(t.topic){e.next=4;break}return e.abrupt("return");case 4:return t.onload(),e.prev=5,e.next=8,t.$axios.$post("/topic/liked/",{user_id:t.user.id,topic_id:t.topic.id});case 8:e.sent?(t.topicLiked=!0,t.likeCount++):(t.topicLiked=!1,t.likeCount--),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),t.notify({msg:"Đã xảy ra lỗi - ".concat(e.t0.message),variant:"danger"});case 15:t.outload();case 16:case"end":return e.stop()}}),e,null,[[5,12]])})))()},makeComment:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.commentContent&&t.user){e.next=2;break}return e.abrupt("return");case 2:return t.onload(),e.prev=3,n={user:t.user.id,topic:t.topic.id,content:t.commentContent},t.commentReply&&(n.parent=t.commentReply),e.next=8,t.$axios.$post("/comment/create/",n);case 8:e.sent,t.commentContent="",t.commentReply=null,t.notify({msg:"Đã thêm bình luận!",variant:"success"}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),t.notify({msg:"Đã xảy ra lỗi - ".concat(e.t0.message),variant:"danger"});case 17:t.outload(),location.reload();case 19:case"end":return e.stop()}}),e,null,[[3,14]])})))()},editComment:function(t){this.editCommentForm.content=t.content,this.editCommentForm.id=t.id,this.editCommentForm.target=t,this.$bvModal.show("edit-comment")},makeEditComment:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$axios.$patch("/comment/".concat(t.editCommentForm.id,"/update/"),{content:t.editCommentForm.content});case 2:t.editCommentForm.target.content=t.editCommentForm.content,t.notify({msg:"Đã sửa bình luận!",variant:"success"});case 4:case"end":return e.stop()}}),e)})))()},makeReply:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.commentContent="<strong>@".concat(t.user_username,"</strong>&nbsp;"),e.commentReply=t.id;case 2:case"end":return n.stop()}}),n)})))()},makeTree:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t.filter((function(t){return t.parent===n})).map((function(n){return Object.assign(n,{children:e.makeTree(t,n.id)})}))}}),mounted:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.$bvModal.hide("search-result"),t.onload(),t.id){e.next=5;break}return t.$router.push("/404"),e.abrupt("return");case 5:return e.prev=5,e.next=8,t.$axios.$get("/topic/".concat(t.id,"/comment"));case 8:return n=e.sent,e.next=11,t.$axios.$get("/topic/list");case 11:if(t.topics=e.sent,t.topic=t.topics.filter((function(e){return e.id===t.id}))[0],t.comments=n[1].comment_data,!t.topic.user){e.next=18;break}return e.next=17,t.$axios.$get("/user/".concat(t.topic.user,"/info"));case 17:t.author=e.sent;case 18:return e.next=20,t.toggleLikeTopic();case 20:return e.next=22,t.toggleLikeTopic();case 22:return e.next=24,t.$axios.$get("/topic/".concat(t.id,"/likes/"));case 24:return t.likeCount=e.sent.number_of_likes,e.next=27,t.$axios.$get("/topic/".concat(t.id,"/views/count"));case 27:return e.next=29,t.$axios.$get("/topic/".concat(t.id,"/views/"));case 29:return t.viewCount=e.sent.number_of_views,e.next=32,t.$axios.$get("/category/list/");case 32:t.categories=e.sent,e.next=38;break;case 35:e.prev=35,e.t0=e.catch(5),e.t0.response.status&&t.$router.push("/404");case 38:t.outload();case 39:case"end":return e.stop()}}),e,null,[[5,35]])})))()}},O=(n(526),Object(_.a)(w,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.topic?n("b-container",{staticClass:"my-md-3 my-1"},[n("b-row",[n("b-col",{attrs:{cols:"12",lg:"8"}},[n("b-card",{staticClass:"my-3"},[n("b-card-text",[n("b-breadcrumb",{attrs:{items:t.breadcrumbCategory}}),t._v(" "),n("h4",[t._v(t._s(t.topic.title))]),t._v(" "),n("div",{staticClass:"info my-2 d-flex justify-content-between"},[n("div",{staticClass:"status"},[n("div",{staticClass:"badge"},[t._v(t._s(t.viewCount)+" lượt xem")]),t._v(" "),n("div",{staticClass:"badge text-danger"},[t._v(t._s(t.likeCount)+" lượt thích")]),t._v(" "),n("div",{staticClass:"badge text-info"},[t._v(t._s(this.comments.length)+" bình luận")])]),t._v(" "),n("div",{staticClass:"date"},[n("i",{staticClass:"text-secondary"},[n("small",[n("b",[t._v(t._s(t.formatDate(t.topic.created_at)))])])])])]),t._v(" "),n("div",{staticClass:"content"},[n("div",{domProps:{innerHTML:t._s(t.topic.content)}}),t._v(" "),n("p",{staticClass:"text-right"},[n("small",[n("i",[n("b-icon",{attrs:{icon:"person-fill"}}),t._v(" "),n("b",[t._v(t._s(t.author?t.author.username:t.topic.user))])],1)])])]),t._v(" "),n("div",{staticClass:"action"},[n("b-button",{attrs:{variant:t.topicLiked?"outline-danger":"danger",size:"sm"},on:{click:t.toggleLikeTopic}},[t._v(t._s(t.topicLiked?"Đã thích":"Thích"))]),t._v(" "),n("b-button",{attrs:{variant:"primary",size:"sm",href:"#comment-box"}},[t._v("Bình luận")]),t._v(" "),n("ShareNetwork",{staticClass:"btn btn-secondary btn-sm text-light",staticStyle:{"background-color":"#4268b3"},attrs:{network:"facebook",url:"https://xanh.life/topic/"+t.topic.id,title:t.topic.title}},[t._v("\n                Chia sẻ\n            ")]),t._v(" "),t.user&&t.author&&t.user.id===t.author.id?n("b-button",{attrs:{variant:"outline-secondary",size:"sm",to:"/topic/"+t.id+"/edit"}},[t._v("Chỉnh sửa")]):t._e()],1)],1)],1),t._v(" "),n("h5",[t._v("THẢO LUẬN")]),t._v(" "),t._l(t.makeTree(t.comments),(function(e){return n("b-card",{key:"comment-"+e.id,staticClass:"my-3"},[n("b-card-text",[n("comment-box",{attrs:{comment:e,topic:t.topic},on:{reply:t.makeReply,edit:t.editComment}})],1)],1)})),t._v(" "),n("b-modal",{attrs:{title:"Chỉnh sửa bình luận",id:"edit-comment"},on:{ok:t.makeEditComment}},[t.user?n("b-form-group",[n("vue-editor",{attrs:{"editor-toolbar":t.commentToolbar},model:{value:t.editCommentForm.content,callback:function(e){t.$set(t.editCommentForm,"content",e)},expression:"editCommentForm.content"}})],1):t._e()],1),t._v(" "),n("b-card",{attrs:{id:"comment-box"}},[n("b-card-text",[n("h6",[t._v("BÌNH LUẬN")]),t._v(" "),t.user?n("b-form-group",[n("vue-editor",{attrs:{"editor-toolbar":t.commentToolbar},model:{value:t.commentContent,callback:function(e){t.commentContent=e},expression:"commentContent"}})],1):t._e(),t._v(" "),t.user?n("b-form-group",{staticClass:"my-0"},[n("b-button",{attrs:{variant:"primary",size:"sm"},on:{click:t.makeComment}},[t._v("Bình luận")])],1):t._e(),t._v(" "),t.user?t._e():n("b-alert",{attrs:{variant:"warning",show:""}},[t._v("Vui lòng đăng nhập để bình luận!")])],1)],1)],2),t._v(" "),n("b-col",{attrs:{cols:"12",lg:"4"}},[n("div",{staticClass:"py-3 sticky"},[t.categories.filter((function(e){return e.parent===t.topic.category})).length?n("b-card",{staticClass:"mb-3"},[n("b-card-text",[n("h5",[t._v("Chuyên mục con")]),t._v(" "),n("b-list-group",t._l(t.categories.filter((function(e){return e.parent===t.topic.category})),(function(e){return n("b-list-group-item",{key:"subcat-"+e.id,staticClass:"p-3"},[n("nuxt-link",{staticClass:"d-block w-100",attrs:{to:"/category/"+e.id}},[n("b-img",{staticClass:"mr-2",staticStyle:{"vertical-align":"middle"},attrs:{src:t.randomAvatar(e.name),width:"32",alt:"placeholder",rounded:"circle"}}),t._v(" "),n("span",{staticStyle:{"font-size":".8em","font-weight":"bold","text-transform":"uppercase"}},[t._v(t._s(e.name))])],1)],1)})),1)],1)],1):t._e(),t._v(" "),n("b-card",[n("b-card-text",[n("h5",[t._v("Chuyên mục")]),t._v(" "),n("b-list-group",t._l(t.categories.filter((function(s){return null===s.parent})),(function(e){return n("b-list-group-item",{key:"side-category-"+e.id,attrs:{to:"/category/"+e.id}},[t._v("\n                "+t._s(e.name)+"\n                ")])})),1)],1)],1)],1)])],1)],1):t._e()}),[],!1,null,null,null));e.default=O.exports}}]);